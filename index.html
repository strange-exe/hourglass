<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hour Glass</title>
  <link rel="icon" type="image/png" sizes="32x32" href="Icons/hour.png">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body {
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      background: linear-gradient(120deg, #D7263D, #02182b);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #02182b;
      flex-direction: column;
      transition: background 1s ease;
    }

    .timer {
      font-size: 6rem;
      font-weight: bold;
      text-align: center;
      text-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
      margin-bottom: 20px;
    }

    .controls button {
      margin: 0 10px;
      padding: 10px 20px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: rgba(255,255,255,0.2);
      color: white;
      backdrop-filter: blur(8px);
      transition: background 0.3s, transform 0.2s;
    }
    .controls button:hover { background: rgba(255,255,255,0.4); transform: scale(1.05);}

    .navbar { position: fixed; top: 50%; right: 20px; transform: translateY(-50%); display: flex; flex-direction: column; gap: 15px; }
    .nav-item { background: rgba(255,255,255,0.3); backdrop-filter: blur(10px); border-radius: 50%; width: 70px; height: 70px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.3); font-size: 1.5rem; }
    .nav-item:hover { transform: scale(1.1); background: rgba(255,255,255,0.35); }
    .tooltip { position: absolute; right: 70px; background: rgba(0,0,0,0.7); padding: 6px 12px; border-radius: 8px; opacity: 0; pointer-events: none; transition: opacity 0.3s; white-space: nowrap; }
    .nav-item:hover .tooltip { opacity: 1; }

    .toast { position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.8); color: white; padding: 12px 20px; border-radius: 12px; opacity: 0; transform: translateY(20px); transition: all 0.5s ease; }
    .toast.show { opacity: 1; transform: translateY(0); }

    .reminder-box { position: fixed; bottom: 100px; right: 20px; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 12px; display: none; flex-direction: column; gap: 10px; }
    .reminder-box input { padding: 8px; border-radius: 6px; border: none; outline: none; text-align: center; }
    .reminder-box button { padding: 8px; border: none; border-radius: 6px; background: rgba(255,255,255,0.3); color: white; cursor: pointer; }

    .stats-panel { position: fixed; right: -400px; top: 0; width: 350px; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(12px); transition: right 0.4s ease; padding: 20px; border-radius: 20px 0 0 20px; overflow-y: auto; }
    .stats-panel.open { right: 0; }
    .stats-panel .close-btn {
      background: crimson;
      border: none;
      color: white;
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s;
    }
    .stats-panel .close-btn:hover { background: darkred; transform: scale(1.05); }

    .theme-picker { display: flex; flex-direction: column; gap: 10px; margin-top: 10px; position: fixed; bottom: 100px; left: 20px; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 12px; }
    .theme-picker label { color: white; display: flex; flex-direction: column; gap: 5px; }
    .theme-picker input[type="text"] { padding: 5px; border-radius: 6px; border: none; outline: none; text-align: center; }
    .theme-picker .close-btn {
      background: crimson;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.8rem;
      cursor: pointer;
      align-self: flex-end;
      transition: all 0.3s;
    }
    .theme-picker .close-btn:hover { background: darkred; transform: scale(1.05); }

    .small-clock { position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 8px; font-size: 1rem; }

    .icon { width: 64px; height: 64px; object-fit: contain; pointer-events: none; filter: drop-shadow(0 0 6px rgba(0,0,0,0.9)); }

    .gradient-transition {
      position: fixed;
      top:0; left:0;
      width:100%; height:100%;
      z-index: 9999;
      pointer-events: none;
      opacity:0;
      transition: opacity 0.5s ease;
    }
    .gradient-transition.active {
      opacity:0.5;
    }

    @media (max-width: 600px) {
      .timer { font-size: 4rem; }
      .nav-item { width: 50px; height: 50px; font-size: 1.2rem; }
      .stats-panel { width: 100%; border-radius: 0; }
    }
  </style>
</head>
<body>
  <div class="timer" id="timer">00:00:00</div>
  <div class="controls" id="controls">
    <button id="startBtn" onclick="startTimer()">Start</button>
    <button id="pauseBtn" onclick="pauseTimer()" style="display:none">Pause</button>
    <button id="resumeBtn" onclick="resumeTimer()" style="display:none">Resume</button>
    <button id="resetBtn" onclick="resetTimer()" style="display:none">Reset</button>
  </div>

  <div class="small-clock" id="smallClock"></div>

  <div class="navbar">
    <div class="nav-item" onclick="toggleFocusMode()"><img src="Icons/foc.png" class="icon"><span class="tooltip">Focus Mode</span></div>
    <div class="nav-item" onclick="toggleThemes()"><img src="Icons/cus.png" class="icon"><span class="tooltip">Themes</span></div>
    <div class="nav-item" onclick="toggleCustomTheme()"><img src="Icons/them.png" class="icon"><span class="tooltip">Custom Theme</span></div>
    <div class="nav-item" onclick="toggleReminderBox()"><img src="Icons/rem.png" class="icon"><span class="tooltip">Set Reminder</span></div>
    <div class="nav-item" onclick="toggleStats()"><img src="Icons/stats.png" class="icon"><span class="tooltip">Stats</span></div>
  </div>

  <div class="reminder-box" id="reminderBox">
    <input type="number" id="reminderMinutes" placeholder="Minutes" min="1">
    <button onclick="setCustomReminder()">Set Reminder</button>
  </div>

  <div class="stats-panel" id="statsPanel">
    <button class="close-btn" onclick="toggleStats()">✖ Close</button>
    <h2>Your Stats</h2>
    <p><b>Today's Study Time:</b> <span id="todayTime">0m</span></p>
    <p><b>Completed Sessions:</b> <span id="sessions">0</span></p>
    <p><b>Streak:</b> <span id="streak">0 days</span></p>
    <canvas id="weeklyChart"></canvas>
  </div>

  <div class="toast" id="toast">Hello!</div>

  <div id="themeAnimation" class="gradient-transition"></div>

  <div class="theme-picker" id="themePicker" style="display:none;">
    <button class="close-btn" onclick="toggleCustomTheme()">✖</button>
    <label>
      Background Color: 
      <input type="color" id="bgColorPicker">
      <input type="text" id="bgColorCode" placeholder="#Hex or name">
    </label>
    <label>
      Clock Color: 
      <input type="color" id="clockColorPicker">
      <input type="text" id="clockColorCode" placeholder="#Hex or name">
    </label>
    <button onclick="applyCustomTheme()">Apply Theme</button>
  </div>

  <script>
    let timerInterval, timerSeconds=0, isPaused=false;
    let stats = JSON.parse(localStorage.getItem("studyStats")) || { today:0, sessions:0, streak:0, lastDate:null, weekly:[0,0,0,0,0,0,0] };
    const startBtn=document.getElementById('startBtn'), pauseBtn=document.getElementById('pauseBtn'), resumeBtn=document.getElementById('resumeBtn'), resetBtn=document.getElementById('resetBtn');

    function updateTimerDisplay(){
      const hrs=String(Math.floor(timerSeconds/3600)).padStart(2,'0');
      const mins=String(Math.floor((timerSeconds%3600)/60)).padStart(2,'0');
      const secs=String(timerSeconds%60).padStart(2,'0');
      document.getElementById('timer').textContent=`${hrs}:${mins}:${secs}`;
    }

    function startTimer(){
      if(timerInterval) return;
      timerInterval=setInterval(()=>{ if(!isPaused){ timerSeconds++; updateTimerDisplay(); updateStatsLive(); } },1000);
      showToast('Timer started!');
      startBtn.style.display='none'; pauseBtn.style.display='inline-block'; resetBtn.style.display='inline-block';
    }
    function pauseTimer(){ isPaused=true; showToast('Timer paused.'); pauseBtn.style.display='none'; resumeBtn.style.display='inline-block'; }
    function resumeTimer(){ isPaused=false; showToast('Timer resumed.'); resumeBtn.style.display='none'; pauseBtn.style.display='inline-block'; }
    function resetTimer(){ clearInterval(timerInterval); timerInterval=null; timerSeconds=0; updateTimerDisplay(); showToast('Timer reset.'); startBtn.style.display='inline-block'; pauseBtn.style.display='none'; resumeBtn.style.display='none'; resetBtn.style.display='none'; stats.sessions++; saveStats(); renderStats(); }

    function showToast(msg){ const toast=document.getElementById('toast'); toast.textContent=msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),3000); }

    function toggleFocusMode(){ if(!document.fullscreenElement){ document.documentElement.requestFullscreen(); showToast('Entered Focus Mode'); } else { document.exitFullscreen(); showToast('Exited Focus Mode'); } }

    function toggleThemes(){
      const colors = [
        ['#f492f0','#5E429C'], ['#B8FB3C','#03045E'], ['#FE7F2D','#233d4d'],
        ['#eaebed','#006989'], ['#D7263D','#02182B'], ['#FFD166','#073B4C'],
        ['#06D6A0','#1B1B1B'], ['#FF61A6','#2E294E'], ['#118AB2','#F5F5F5'],
        ['#EF476F','#2A2A72'], ['#FF9F1C','#011627'], ['#9D4EDD','#240046'],
        ['#06BCC1','#33312E'], ['#FF6B6B','#1D1E22'], ['#4ECDC4','#1A535C'],
        ['#FDCB82','#2D2D2D'], ['#84DCC6','#1E2D2F'], ['#FF8C42','#2F2F2F'],
        ['#A8DADC','#1D3557'], ['#FFC8DD','#3C096C']
      ];
      
      const selected = colors[Math.floor(Math.random() * colors.length)];
      
      const anim = document.getElementById('themeAnimation');
      anim.style.background = `linear-gradient(120deg, ${selected[0]}, ${selected[1]})`;
      anim.classList.add('active');
      setTimeout(() => anim.classList.remove('active'), 500);

      document.body.style.background = `linear-gradient(120deg, ${selected[0]}, ${selected[1]})`;
      document.getElementById('timer').style.color = selected[1];

      showToast('Theme changed!');
    }

    function toggleCustomTheme(){
      const picker=document.getElementById('themePicker');
      picker.style.display=picker.style.display==='none'?'flex':'none';
      if(picker.style.display==='flex'){
        const currentBg = window.getComputedStyle(document.body).backgroundColor;
        const currentClock = window.getComputedStyle(document.getElementById("timer")).color;
        document.getElementById("bgColorPicker").value = rgbToHex(currentBg);
        document.getElementById("bgColorCode").value = rgbToHex(currentBg);
        document.getElementById("clockColorPicker").value = rgbToHex(currentClock);
        document.getElementById("clockColorCode").value = rgbToHex(currentClock);
      }
    }

    function rgbToHex(color){
      if(color.startsWith("rgb")){
        const rgb = color.match(/\d+/g).map(Number);
        return "#" + rgb.map(x => x.toString(16).padStart(2,"0")).join("");
      }
      return color;
    }

    function applyCustomTheme(){
      let bg=document.getElementById('bgColorCode').value || document.getElementById('bgColorPicker').value;
      let clock=document.getElementById('clockColorCode').value || document.getElementById('clockColorPicker').value;
      document.body.style.background=bg;
      document.getElementById('timer').style.color=clock;
      showToast('Custom theme applied!');
    }

    document.getElementById("bgColorPicker").addEventListener("input", e=>{
      document.body.style.background=e.target.value;
      document.getElementById("bgColorCode").value=e.target.value;
    });
    document.getElementById("clockColorPicker").addEventListener("input", e=>{
      document.getElementById("timer").style.color=e.target.value;
      document.getElementById("clockColorCode").value=e.target.value;
    });
    document.getElementById("bgColorCode").addEventListener("input", e=>{
      document.body.style.background=e.target.value;
    });
    document.getElementById("clockColorCode").addEventListener("input", e=>{
      document.getElementById("timer").style.color=e.target.value;
    });

    function toggleReminderBox(){ const box=document.getElementById('reminderBox'); box.style.display=box.style.display==='flex'?'none':'flex'; }
    function setCustomReminder(){ const minutes=document.getElementById('reminderMinutes').value; if(!minutes||minutes<=0){ showToast('Enter valid minutes'); return; } showToast(`Reminder set for ${minutes} minutes!`); setTimeout(()=>{ showToast(`⏰ ${minutes} minutes are up! Take a break.`); }, minutes*60000); document.getElementById('reminderBox').style.display='none'; }

    function toggleStats(){ document.getElementById('statsPanel').classList.toggle('open'); renderStats(); }
    function updateStatsLive(){ stats.today=timerSeconds/60; saveStats(); renderStats(); }
    function saveStats(){ let today=new Date().toDateString(); if(stats.lastDate!==today){ stats.streak++; stats.lastDate=today; stats.weekly.shift(); stats.weekly.push(Math.floor(stats.today)); stats.today=0; } localStorage.setItem('studyStats',JSON.stringify(stats)); }

    function renderStats(){
      document.getElementById('todayTime').innerText=`${Math.floor(stats.today)}m`;
      document.getElementById('sessions').innerText=stats.sessions;
      document.getElementById('streak').innerText=`${stats.streak} days`;
      const ctx=document.getElementById('weeklyChart').getContext('2d');
      if(window.weeklyChart && typeof window.weeklyChart.destroy==='function'){ window.weeklyChart.destroy(); }
      window.weeklyChart=new Chart(ctx,{ type:'bar', data:{ labels:['Mon','Tue','Wed','Thu','Fri','Sat','Sun'], datasets:[{label:'Minutes', data:stats.weekly, backgroundColor:'rgba(75,192,192,0.6)'}] }, options:{ responsive:true, scales:{ y:{ beginAtZero:true } } } });
    }

    function updateSmallClock(){ const now=new Date(); document.getElementById('smallClock').textContent=now.toLocaleTimeString('en-GB',{hour12:false}); }
    setInterval(updateSmallClock,1000); updateSmallClock();

    updateTimerDisplay(); renderStats();
  </script>
</body>
</html>
